<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Document</title>
    <style>
        #chart_back2{width: 800px; height: 600px; border:1px solid #000;}
    </style>
</head>
<body>
    <div>
        <h2>매출액</h2>
        <input type="text" name="mm_data" id="mm_data">
        <button type="button" onclick="chartBtn()">가져오기</button>
    </div>
    <div id='chart_back2'>
        <canvas id="myChart2"></canvas>
    </div>

    <script>
        function chartBtn(){
            alert("데이터를 가져와 차트를 그립니다.")
            // 요청번호
            let input_data = $('#mm_data').val();
            //chart그리기에 필요한 데이터
            c_year = [];
            c_data = [];

            //ajax로 데이터 가져오기
            $.ajax({
                url : '/chart2_json/', //요청경로
                type : 'GET', //요청방식
                dataType : 'json', //응답받을 데이터 형식
                headers:{'X_CRSFToken':'{{csrf_token}}'}, //쉼표 안붙이면 에러
                data : {'input_data' : input_data}, //요청시 전달값
                success : function(data){
                    //통신성공시 실행할 코드
                    alert('성공');
                    let c_year = data.cc_year;
                    let c_data = data.cc_data;
                    console.log(data);

                    // 비동기 방식으로 진행되어 ajax 데이터가 늦게 전달됨.
                    // 차트 그리기 명령어도 ajax안에 입력이 되어야함.
                    //chart그리기
                    const ctx = document.getElementById('myChart2');

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                        labels: label_data,
                        datasets: [{
                            label: '매출액',
                            data: c_data,
                            borderWidth: 1
                        }]
                        },
                        options: {
                        scales: {
                            y: {
                            beginAtZero: true
                            }
                        }
                        }
                    });// chart그리기

                },
                error : function(){
                    console.log("에러발생");
                }
            });//ajax끝


        };//chart끝

    </script>
</body>
</html>